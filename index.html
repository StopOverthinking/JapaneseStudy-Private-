<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일본어 단어 학습</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 이어하기 오버레이 스타일 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .overlay-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 90%;
            width: 400px;
        }
        .overlay-buttons {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .overlay-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s;
        }
        .overlay-buttons button:active {
            transform: scale(0.98);
        }
        #btn-resume-yes {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: scale(1.05); /* '예' 버튼 강조 */
        }
        #btn-resume-no {
            background-color: #9e9e9e;
            color: white;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- 시작 화면 / 모드 선택 -->
        <div id="start-screen" class="screen active">
            <h1>일본어 단어 학습</h1>
            <div class="mode-selection">
                <button id="start-list-btn">목록 모드</button>
                <p class="mode-description">전체 단어를 목록으로 봅니다.</p>
            </div>
            <div class="mode-selection">
                <button id="start-learning-btn">학습 모드</button>
                <p class="mode-description">카드를 넘기며 단어를 학습합니다.</p>
            </div>
            <div class="mode-selection">
                <button id="start-game-mode-btn">게임 모드</button>
                <p class="mode-description">다양한 학습 게임을 즐겨보세요.</p>
            </div>
            <div class="mode-selection">
                <button id="start-exam-mode-btn" style="background-color: #E91E63;">시험 모드</button>
                <p class="mode-description">단어장 전체를 테스트합니다.</p>
            </div>
        </div>

        <!-- 목록 모드 -->
        <div id="list-mode" class="screen">
            <h2>단어 목록</h2>
            <div id="list-controls" class="hidden">
                <button id="toggle-word-btn">단어 숨기기</button>
                <button id="toggle-meaning-btn">뜻 숨기기</button>
            </div>
            <div id="vocabulary-list-container"></div>
            <button id="back-to-start-btn">돌아가기</button>
        </div>

        <!-- 학습 모드 -->
        <div id="learning-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-learning" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>학습 모드</h2>
            <div id="learning-setup">
                <div class="setting-item">
                    <label for="vocab-set-select">학습할 단어장:</label>
                    <select id="vocab-set-select"></select>
                </div>
                <div class="setting-item" id="range-setting-container">
                    <label class="range-toggle-label">
                        <input type="checkbox" id="range-checkbox"> 학습 범위 지정
                    </label>
                    <div id="range-selection" class="hidden">
                        <input type="number" id="range-start" min="1" placeholder="시작">
                        <span>~</span>
                        <input type="number" id="range-end" min="1" placeholder="끝">
                    </div>
                </div>
                <div class="setting-item">
                    <label for="word-count">학습할 단어 개수:</label>
                    <div class="word-count-wrapper">
                        <input type="number" id="word-count" value="10" min="1">
                        <div id="word-count-controls" class="word-count-controls">
                            <button data-value="10">+10</button> <button data-value="5">+5</button> <button data-value="1">+1</button>
                            <button data-value="-10">-10</button> <button data-value="-5">-5</button> <button data-value="-1">-1</button>
                        </div>
                    </div>
                </div>
                <fieldset>
                    <legend>카드 앞면 표시:</legend>
                    <label><input type="radio" name="initial-display" value="japanese" checked> 일본어/독음</label>
                    <label><input type="radio" name="initial-display" value="meaning"> 뜻</label>
                </fieldset>
                <button id="start-session-btn">학습 시작</button>
            </div>

            <div id="flashcard-session" class="hidden">
                <div class="card-container">
                    <button id="btn-prev-card" class="prev-card-btn">‹</button>
                    <button id="btn-favorite" class="favorite-btn">☆</button>
                    <div id="flashcard" class="flashcard">
                        <div class="card-face card-front">
                            <!-- 일본어/독음 또는 뜻이 여기에 표시됩니다. -->
                            <p class="japanese-text"></p>
                            <p class="reading-text"></p>
                        </div>
                        <div class="card-face card-back">
                            <!-- 반대 내용이 여기에 표시됩니다. -->
                            <p class="meaning-text"></p>
                        </div>
                    </div>
                </div>
                <div class="learning-options">
                    <label><input type="checkbox" id="toggle-reading-checkbox"> 독음 숨기기</label>
                </div>
                <div class="card-actions">
                    <button id="btn-known" class="action-btn known">알고 있음</button>
                    <button id="btn-unknown" class="action-btn unknown">모름</button>
                </div>
                <p id="progress-text">0/0</p>
            </div>
        </div>

        <!-- 게임 선택 모드 (신규) -->
        <div id="game-selection-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-game-selection" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>게임 선택</h2>
            <div class="mode-selection">
                <button id="open-speed-quiz-btn" style="background-color: #FF9800;">스피드퀴즈</button>
                <p class="mode-description">스피드 객관식 퀴즈 (30문제)</p>
            </div>
            
            <!-- 닉네임 설정 (신규) -->
            <div class="nickname-setting" style="margin-top: 30px; text-align: center;">
                <label for="player-nickname-input" style="font-size: 1.1em; color: #555;">내 닉네임: </label>
                <input type="text" id="player-nickname-input" placeholder="닉네임 입력" style="padding: 8px; font-size: 1em; border: 1px solid #ccc; border-radius: 5px; width: 150px; text-align: center;">
            </div>
        </div>

        <!-- 스피드퀴즈 모드 -->
        <div id="speed-quiz-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-speed-quiz" class="back-btn">‹ 그만두기</button>
            </div>

            <!-- 모드 선택 메뉴 (신규) -->
            <div id="speed-quiz-menu">
                <h2 id="speed-quiz-title" style="margin-top: 0;">스피드퀴즈 모드 선택</h2>
                
                <!-- 단계 1: 모드 선택 -->
                <div id="speed-quiz-mode-select" class="quiz-mode-buttons">
                    <button id="btn-single-mode" class="mode-select-btn">싱글 플레이</button>
                    <button id="btn-vs-bot-mode" class="mode-select-btn">PVP (봇 대결)</button>
                </div>
                
                <!-- 단계 2: 싱글 플레이 대기 (기록 + 시작 버튼) -->
                <div id="single-mode-pre-screen" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
                    <div id="single-mode-records" class="records-container">
                        <h3>🏆 명예의 전당 (Top 10)</h3>
                        <ul id="record-list"></ul>
                    </div>
                    <button id="btn-start-single-game" style="margin-top: 20px; background-color: #4CAF50; font-size: 1.2em; padding: 15px 40px; width: auto;">게임 시작</button>
                </div>
            </div>

            <!-- 게임 영역 (기존 요소를 감쌈) -->
            <div id="speed-quiz-game-area" class="hidden">
                <!-- 레이스 바 (신규) -->
                <div id="speed-quiz-race-track">
                    <div class="race-bar-row">
                        <span class="race-label">나</span>
                        <div class="race-bar"><div id="player-race-fill" class="race-fill"></div></div>
                    </div>
                    <div class="race-bar-row hidden" id="bot-race-row">
                        <span class="race-label">봇</span>
                        <div class="race-bar"><div id="bot-race-fill" class="race-fill bot"></div></div>
                    </div>
                </div>
                <div id="speed-quiz-status-bar">
                    <span id="speed-quiz-progress">1/30</span>
                    <span id="speed-quiz-score">점수: 0</span>
                    <span id="speed-quiz-bot-score" class="hidden">상대: 0</span>
                </div>
                <div id="speed-quiz-timer-bar"><div id="speed-quiz-timer-fill"></div></div>
                
                <div id="speed-quiz-content">
                    <div id="speed-quiz-question"></div>
                    <div id="speed-quiz-options"></div>
                </div>

                <!-- 디버그 정보 (신규) -->
                <div id="speed-quiz-debug-info" class="hidden"></div>
            </div>
            
            <div id="speed-quiz-result" class="hidden">
                <h2>퀴즈 종료!</h2>
                <p style="font-size: 1.5em; margin: 20px;">최종 점수: <span id="final-score" style="font-weight:bold; color:#4CAF50;"></span></p>
                <p style="font-size: 1.1em; margin: 10px;">평균 소요 시간: <span id="average-time" style="font-weight:bold;"></span>초</p>
                <div id="speed-quiz-wrong-list"></div>
                <button id="restart-speed-quiz-btn">메뉴로 돌아가기</button>
            </div>
        </div>

        <!-- 대전 상대 소개 화면 (신규) -->
        <div id="match-intro-screen" class="overlay hidden" style="background-color: rgba(0,0,0,0.9); color: white; flex-direction: column;">
            <h2 style="color: #FFC107; font-size: 2em; margin-bottom: 10px;">MATCH FOUND!</h2>
            <div style="display: flex; align-items: center; gap: 20px; font-size: 1.5em;">
                <span id="intro-player-name" style="color: #4CAF50; font-weight: bold;">나</span>
                <span style="font-size: 0.8em;">VS</span>
                <span id="intro-bot-name" style="color: #FF5722; font-weight: bold;">상대방</span>
            </div>
        </div>

        <!-- 카운트다운 오버레이 (신규) -->
        <div id="countdown-overlay" class="overlay hidden" style="background: rgba(255,255,255,0.3); backdrop-filter: blur(2px);">
            <div id="countdown-number" style="font-size: 10em; font-weight: bold; color: var(--primary-color); text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">3</div>
        </div>

        <!-- 티어 결과 화면 (신규) -->
        <div id="tier-result-screen" class="screen">
            <h2>티어 변동</h2>
            <div class="tier-animation-container">
                <div id="tier-badge" class="tier-badge"></div>
                <div id="tier-name" class="tier-name"></div>
                <div id="tier-division" class="tier-division"></div>
            </div>
            <div id="mmr-progress-container"><div id="mmr-progress-bar"></div></div>
            <p id="mmr-change-text"></p>
            <button id="close-tier-screen-btn">확인</button>
        </div>

        <!-- 시험 모드: 단어장 선택 -->
        <div id="exam-selection-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-exam-select" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>시험 볼 단어장 선택</h2>
            <div id="exam-set-list" class="mode-selection">
                <!-- 자바스크립트로 버튼 생성 -->
            </div>
        </div>

        <!-- 시험 모드: 진행 화면 -->
        <div id="exam-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-exam" class="back-btn">‹ 그만두기</button>
            </div>
            <h2 id="exam-progress">문제 1 / 10</h2>
            <div class="exam-container">
                <div id="exam-question" class="meaning-text"></div>
                <input type="text" id="exam-input" placeholder="일본어 정답 입력" autocomplete="off">
                
                <button id="toggle-input-method" class="secondary-btn">손글씨 입력 열기</button>
                
                <div id="handwriting-area" class="hidden">
                    <canvas id="handwriting-canvas" width="300" height="200"></canvas>
                    <div class="hw-controls">
                        <button id="hw-clear">지우기</button>
                        <button id="hw-recognize">인식하기</button>
                    </div>
                    <div id="hw-candidates"></div>
                </div>

                <button id="exam-next-btn">다음</button>
            </div>
        </div>

        <!-- 시험 모드: 결과 화면 -->
        <div id="exam-result-mode" class="screen">
            <h2>시험 결과</h2>
            <p class="score-display">점수: <span id="exam-score"></span></p>
            <div id="exam-wrong-list"></div>
            <button id="restart-exam-btn">다른 시험 보기</button>
            <button id="back-to-start-from-exam-result">메인으로</button>
        </div>

        <!-- 결과 화면 (선택 사항) -->
        <div id="results-screen" class="screen">
            <h2>학습 결과</h2>
            <p>모든 단어를 학습했습니다!</p>
            <button id="restart-learning-btn">다시 학습하기</button>
        </div>
    </div>

    <!-- 이어하기 확인 오버레이 -->
    <div id="resume-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3>학습 기록 발견</h3>
            <p>이전에 완료하지 못한 학습이 있습니다.<br>이어서 진행하시겠습니까?</p>
            <div class="overlay-buttons">
                <button id="btn-resume-yes">예, 이어서 합니다</button>
                <button id="btn-resume-no">아니오, 새로 시작합니다</button>
            </div>
        </div>
    </div>

    <script src="vocabulary.js"></script>
    <script src="vocab/vocab_pagoda.js"></script>
    <script src="vocab/vocab_example.js"></script>
    <script src="bot_nicknames.js"></script>
    <script src="learning_mode.js"></script>
    <script src="speed_quiz_mode.js"></script>
    <script src="handwriting_recognition.js"></script>
    <script src="exam_mode.js"></script>
    <script src="app.js"></script>
</body>
</html>
