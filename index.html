<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일본어 단어 학습</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* 이어하기 오버레이 스타일 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .overlay-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 90%;
            width: 400px;
        }
        .overlay-buttons {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .overlay-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.1s;
        }
        .overlay-buttons button:active {
            transform: scale(0.98);
        }
        #btn-resume-yes {
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: scale(1.05); /* '예' 버튼 강조 */
        }
        #btn-resume-no {
            background-color: #9e9e9e;
            color: white;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <!-- 시작 화면 / 모드 선택 -->
        <div id="start-screen" class="screen active">
            <h1>일본어 단어 학습</h1>
            <div class="mode-selection">
                <button id="start-list-btn">목록 모드</button>
                <p class="mode-description">전체 단어를 목록으로 봅니다.</p>
            </div>
            <div class="mode-selection">
                <button id="start-learning-btn">학습 모드</button>
                <p class="mode-description">카드를 넘기며 단어를 학습합니다.</p>
            </div>
            <div class="mode-selection">
                <button id="start-game-mode-btn">게임 모드</button>
                <p class="mode-description">다양한 학습 게임을 즐겨보세요.</p>
            </div>
            <div class="mode-selection">
                <button id="start-exam-mode-btn" style="background-color: #E91E63;">시험 모드</button>
                <p class="mode-description">단어장 전체를 테스트합니다.</p>
            </div>
            <div class="mode-selection">
                <button id="start-data-management-btn" style="background-color: #607D8B;">데이터 관리</button>
                <p class="mode-description">학습 기록을 백업하거나 복원합니다.</p>
            </div>
        </div>

        <!-- 목록 모드 -->
        <div id="list-mode" class="screen">
            <h2>단어 목록</h2>
            <div id="list-controls" class="hidden">
                <button id="toggle-word-btn">단어 숨기기</button>
                <button id="toggle-meaning-btn">뜻 숨기기</button>
            </div>
            <div id="vocabulary-list-container"></div>
            <button id="back-to-start-btn">돌아가기</button>
        </div>

        <!-- 학습 모드 -->
        <div id="learning-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-learning" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>학습 모드</h2>
            <div id="learning-setup">
                <div class="setting-item">
                    <label for="vocab-set-select">학습할 단어장:</label>
                    <select id="vocab-set-select"></select>
                </div>
                <div class="setting-item" id="range-setting-container">
                    <label class="range-toggle-label">
                        <input type="checkbox" id="range-checkbox"> 학습 범위 지정
                    </label>
                    <div id="range-selection" class="hidden">
                        <input type="number" id="range-start" min="1" placeholder="시작">
                        <span>~</span>
                        <input type="number" id="range-end" min="1" placeholder="끝">
                    </div>
                </div>
                <div class="setting-item">
                    <label for="word-count">학습할 단어 개수:</label>
                    <div class="word-count-wrapper">
                        <input type="number" id="word-count" value="10" min="1">
                        <div id="word-count-controls" class="word-count-controls">
                            <button data-value="10">+10</button> <button data-value="5">+5</button> <button data-value="1">+1</button>
                            <button data-value="-10">-10</button> <button data-value="-5">-5</button> <button data-value="-1">-1</button>
                        </div>
                    </div>
                </div>
                <fieldset>
                    <legend>카드 앞면 표시:</legend>
                    <label><input type="radio" name="initial-display" value="japanese" checked> 일본어/독음</label>
                    <label><input type="radio" name="initial-display" value="meaning"> 뜻</label>
                </fieldset>
                <button id="start-session-btn">학습 시작</button>
            </div>

            <div id="flashcard-session" class="hidden">
                <div class="card-container">
                    <button id="btn-prev-card" class="prev-card-btn">‹</button>
                    <button id="btn-favorite" class="favorite-btn">☆</button>
                    <div id="flashcard" class="flashcard">
                        <div class="card-face card-front">
                            <!-- 일본어/독음 또는 뜻이 여기에 표시됩니다. -->
                            <p class="japanese-text"></p>
                            <p class="reading-text"></p>
                        </div>
                        <div class="card-face card-back">
                            <!-- 반대 내용이 여기에 표시됩니다. -->
                            <p class="meaning-text"></p>
                        </div>
                    </div>
                </div>
                <div class="learning-options">
                    <label><input type="checkbox" id="toggle-reading-checkbox"> 독음 숨기기</label>
                </div>
                <div class="card-actions">
                    <button id="btn-known" class="action-btn known">알고 있음</button>
                    <button id="btn-unknown" class="action-btn unknown">모름</button>
                </div>
                <p id="progress-text">0/0</p>
            </div>
        </div>

        <!-- 게임 선택 모드 (신규) -->
        <div id="game-selection-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-game-selection" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>게임 선택</h2>
            <div class="mode-selection">
                <button id="open-speed-quiz-btn" style="background-color: #FF9800;">스피드퀴즈</button>
                <p class="mode-description">스피드 객관식 퀴즈 (30문제)</p>
            </div>
        </div>

        <!-- 스피드퀴즈 모드 -->
        <div id="speed-quiz-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-speed-quiz" class="back-btn">‹ 그만두기</button>
            </div>

            <!-- 모드 선택 메뉴 (신규) -->
            <div id="speed-quiz-menu">
                <h2 id="speed-quiz-title" style="margin-top: 0;">스피드퀴즈 모드 선택</h2>
                
                <!-- 닉네임 관리 영역 -->
                <div class="nickname-container">
                    <div id="nickname-display-area">
                        <span id="current-nickname">플레이어</span>
                        <button id="btn-edit-nickname" class="small-btn">수정</button>
                    </div>
                </div>

                <div id="speed-quiz-mode-select">
                    <div class="quiz-mode-buttons">
                        <button id="btn-single-objective" class="mode-select-btn" style="background-color: #2196F3;">싱글 - 객관식</button>
                        <button id="btn-single-subjective" class="mode-select-btn" style="background-color: #03A9F4;">싱글 - 발음</button>
                        <button id="btn-vs-objective" class="mode-select-btn" style="background-color: #9C27B0;">대전 - 객관식</button>
                        <button id="btn-vs-subjective" class="mode-select-btn" style="background-color: #673AB7;">대전 - 발음</button>
                    </div>
                </div>
                
                <!-- 싱글 플레이 대기 화면 (신규) -->
                <div id="single-mode-pre-screen" class="hidden" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
                    <div id="single-mode-records" class="records-container">
                        <h3>🏆 명예의 전당 (Top 10)</h3>
                        <ul id="record-list"></ul>
                    </div>
                    <button id="btn-start-single-game" style="margin-top: 20px; background-color: #4CAF50; width: 80%; max-width: 300px; font-size: 1.2em; padding: 15px;">게임 시작</button>
                </div>
            </div>

            <!-- 게임 영역 (기존 요소를 감쌈) -->
            <div id="speed-quiz-game-area" class="hidden">
                <!-- 레이스 바 (신규) -->
                <div id="speed-quiz-race-track">
                    <div class="race-bar-row">
                        <span class="race-label">나</span>
                        <div class="race-bar"><div id="player-race-fill" class="race-fill"></div></div>
                    </div>
                    <div class="race-bar-row hidden" id="bot-race-row">
                        <span class="race-label">봇</span>
                        <div class="race-bar"><div id="bot-race-fill" class="race-fill bot"></div></div>
                    </div>
                </div>
                <div id="speed-quiz-status-bar">
                    <span id="speed-quiz-progress">1/30</span>
                    <span id="speed-quiz-score">점수: 0</span>
                    <span id="speed-quiz-bot-score" class="hidden">봇: 0</span>
                </div>
                <div id="speed-quiz-timer-bar"><div id="speed-quiz-timer-fill"></div></div>
                
                <div id="speed-quiz-content">
                    <div id="speed-quiz-question"></div>
                    <div id="speed-quiz-options"></div>
                    <!-- 주관식 입력 영역 -->
                    <div id="speed-quiz-input-area" class="hidden">
                        <input type="text" id="speed-quiz-input" placeholder="발음을 입력하세요 (예: あした, ashita)" autocomplete="off">
                        <button id="btn-submit-answer">제출</button>
                    </div>
                </div>

                <!-- 디버그 정보 (신규) -->
                <div id="speed-quiz-debug-info" class="hidden"></div>
            </div>
            
            <div id="speed-quiz-result" class="hidden">
                <h2>퀴즈 종료!</h2>
                <p style="font-size: 1.5em; margin: 20px;">최종 점수: <span id="final-score" style="font-weight:bold; color:#4CAF50;"></span></p>
                <p style="font-size: 1.1em; margin: 10px;">평균 소요 시간: <span id="average-time" style="font-weight:bold;"></span>초</p>
                <div id="speed-quiz-wrong-list"></div>
                <button id="restart-speed-quiz-btn">메뉴로 돌아가기</button>
            </div>
        </div>

        <!-- 시험 모드: 단어장 선택 -->
        <div id="exam-selection-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-exam-select" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>시험 볼 단어장 선택</h2>
            <div id="exam-set-list" class="mode-selection">
                <!-- 자바스크립트로 버튼 생성 -->
            </div>
        </div>

        <!-- 시험 모드: 진행 화면 -->
        <div id="exam-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-exam" class="back-btn">‹ 그만두기</button>
            </div>
            <h2 id="exam-progress">문제 1 / 10</h2>
            <div class="exam-container">
                <div id="exam-question" class="meaning-text"></div>
                <input type="text" id="exam-input" placeholder="일본어 정답 입력" autocomplete="off">
                
                <button id="toggle-input-method" class="secondary-btn">손글씨 입력 열기</button>
                
                <div id="handwriting-area" class="hidden">
                    <canvas id="handwriting-canvas" width="300" height="200"></canvas>
                    <div class="hw-controls">
                        <button id="hw-clear">지우기</button>
                        <button id="hw-recognize">인식하기</button>
                    </div>
                    <div id="hw-candidates"></div>
                </div>

                <button id="exam-next-btn">다음</button>
            </div>
        </div>

        <!-- 시험 모드: 결과 화면 -->
        <div id="exam-result-mode" class="screen">
            <h2>시험 결과</h2>
            <p class="score-display">점수: <span id="exam-score"></span></p>
            <div id="exam-wrong-list"></div>
            <button id="restart-exam-btn">다른 시험 보기</button>
            <button id="back-to-start-from-exam-result">메인으로</button>
        </div>

        <!-- 데이터 관리 모드 -->
        <div id="data-management-mode" class="screen">
            <div class="screen-header">
                <button id="back-to-start-from-data-mgmt" class="back-btn">‹ 돌아가기</button>
            </div>
            <h2>데이터 관리</h2>
            <div class="data-mgmt-container">
                <div class="data-section">
                    <h3>데이터 내보내기 (백업)</h3>
                    <p>현재 기기의 모든 학습 데이터를 저장합니다.</p>
                    <button id="export-clipboard-btn">클립보드로 복사</button>
                    <button id="export-file-btn">파일로 저장 (.json)</button>
                </div>
                <div class="data-section">
                    <h3>데이터 가져오기 (복원)</h3>
                    <p>이전 데이터를 불러옵니다.<br>(주의: 현재 데이터는 덮어씌워집니다)</p>
                    <button id="import-clipboard-btn">클립보드에서 가져오기</button>
                    <button id="import-file-btn">파일에서 불러오기</button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>
        </div>

        <!-- 결과 화면 (선택 사항) -->
        <div id="results-screen" class="screen">
            <h2>학습 결과</h2>
            <p>모든 단어를 학습했습니다!</p>
            <button id="restart-learning-btn">다시 학습하기</button>
        </div>

        <!-- 티어 결과 화면 (신규) -->
        <div id="tier-result-screen" class="screen">
            <h2>대전 결과</h2>
            <div class="tier-container" style="text-align: center;">
                <div id="tier-badge" style="width: 100px; height: 100px; border-radius: 50%; background: #ccc; margin: 0 auto; display: flex; align-items: center; justify-content: center; font-size: 3em; color: white; font-weight: bold;">?</div>
                <h3 id="tier-name" style="margin: 10px 0; font-size: 2em;">Unranked</h3>
                <p id="tier-division" style="color: #666;">0 LP</p>
                
                <div class="mmr-progress-container" style="width: 80%; max-width: 300px; height: 10px; background: #eee; border-radius: 5px; margin: 20px auto; overflow: hidden;">
                    <div id="mmr-progress-bar" style="width: 0%; height: 100%; background: #4CAF50; transition: width 1s ease-out;"></div>
                </div>
                <p id="mmr-change-text" style="font-weight: bold; font-size: 1.2em; margin-top: 10px;">+0 LP</p>
            </div>
            <button id="close-tier-screen-btn" style="margin-top: 30px;">확인</button>
        </div>

        <!-- 매치 인트로 화면 (신규) -->
        <div id="match-intro-screen" class="screen hidden">
            <div class="vs-container">
                <div class="player-intro">
                    <div class="avatar">👤</div>
                    <div id="intro-player-name" class="name">Player</div>
                </div>
                <div class="vs-logo">VS</div>
                <div class="bot-intro">
                    <div class="avatar">👤</div>
                    <div id="intro-bot-name" class="name">Bot</div>
                </div>
            </div>
        </div>

        <!-- 매칭 중 오버레이 (신규) -->
        <div id="matchmaking-overlay" class="overlay hidden" style="background: rgba(0,0,0,0.85); z-index: 2200; flex-direction: column; color: white;">
            <div class="spinner"></div>
            <h2 style="margin-top: 20px; font-weight: normal;">대전 상대 찾는 중...</h2>
        </div>

        <!-- 닉네임 수정 모달 -->
        <div id="nickname-modal" class="overlay hidden">
            <div class="overlay-content">
                <h3>닉네임 수정</h3>
                <input type="text" id="nickname-edit-input" placeholder="새 닉네임 입력" style="width: 80%; padding: 10px; margin: 15px 0; font-size: 1.1em; text-align: center;">
                <div class="overlay-buttons">
                    <button id="btn-save-nickname">저장</button>
                    <button id="btn-cancel-nickname" style="background-color: #999;">취소</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 이어하기 확인 오버레이 -->
    <div id="resume-overlay" class="overlay hidden">
        <div class="overlay-content">
            <h3>학습 기록 발견</h3>
            <p>이전에 완료하지 못한 학습이 있습니다.<br>이어서 진행하시겠습니까?</p>
            <div class="overlay-buttons">
                <button id="btn-resume-yes">예, 이어서 합니다</button>
                <button id="btn-resume-no">아니오, 새로 시작합니다</button>
            </div>
        </div>
    </div>

    <!-- 카운트다운 오버레이 -->
    <div id="countdown-overlay" class="overlay hidden" style="background: rgba(0,0,0,0.3); z-index: 2100;">
        <div id="countdown-number" style="font-size: 8em; font-weight: bold; color: white; text-shadow: 0 0 10px rgba(0,0,0,0.5);">3</div>
    </div>

    <script src="vocabulary.js"></script>
    <script src="vocab/vocab_pagodaN3.js"></script>
    <script src="vocab/vocab_example.js"></script>
    <script src="vocab/vocab_handmade.js"></script>
    <script src="vocab/vocab_darakwon_verb.js"></script>
    <script src="learning_mode.js"></script>
    <script src="bot_nicknames.js"></script>
    <script src="speed_quiz_mode.js"></script>
    <script src="handwriting_recognition.js"></script>
    <script src="exam_mode.js"></script>
    <script src="app.js"></script>
</body>
</html>
